<!DOCTYPE html>
<html>
<head>
    <title>Detector de Soldadura</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { 
            background: #0f0f0f; 
            color: white; 
            text-align: center; 
            font-family: Arial; 
            margin: 0; 
            padding: 20px;
        }
        video { 
            border-radius: 12px; 
            border: 4px solid #555; 
            margin-top: 20px;
        }
        button {
            background: #00b050;
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 20px;
            border-radius: 10px;
            cursor: pointer;
        }
        #label {
            font-size: 30px;
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h1>Detector de Soldaduras</h1>
<button onclick="init()">Iniciar Cámara</button>

<div id="webcam-container"></div>
<div id="label"></div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>

<script>
let model, webcam, labelContainer;

const modelURL = "https://osvald2706.github.io/Detector-soldadura/model.json";
const metadataURL = "https://osvald2706.github.io/Detector-soldadura/metadata.json";

async function init() {
    model = await tmImage.load(modelURL, metadataURL);

    // USAR CÁMARA FRONTAL
    const constraints = {
        video: { facingMode: "user" }
    };

    const flip = true;
    webcam = new tmImage.Webcam(300, 300, flip);
    await webcam.setup(constraints);
    await webcam.play();
    window.requestAnimationFrame(loop);

    document.getElementById("webcam-container").appendChild(webcam.canvas);
}

async function loop() {
    webcam.update();
    await predict();
    window.requestAnimationFrame(loop);
}

async function predict() {
    const prediction = await model.predict(webcam.canvas);

    let best = prediction[0];
    prediction.forEach(p => {
        if (p.probability > best.probability) best = p;
    });

    document.getElementById("label").innerHTML =
        best.className.toUpperCase() + " (" + (best.probability * 100).toFixed(1) + "%)";
}
</script>

</body>
</html>
